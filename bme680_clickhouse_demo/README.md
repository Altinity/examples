# BME680 Sensor Data Logger for ClickHouse

Stream temperature, humidity, and pressure data from a BME680 sensor on Raspberry Pi directly to ClickHouse for real-time IoT analytics.

## Overview

This project demonstrates how to:
- Read environmental data from a BME680 sensor
- Apply temperature calibration for sensor self-heating
- Send data to ClickHouse via HTTP POST
- Display system stats on an OLED screen (optional)

Perfect for building IoT dashboards, environmental monitoring systems, or learning about sensor integration with analytical databases.

## What You'll Need

### Hardware
- Raspberry Pi (3 or newer recommended)
- BME680 breakout board (we used Pimoroni BME680 Breakout)
- MicroSD card (16GB+)
- Optional: OLED display (e.g., UCTronics Pi Rack Pro with SH1106 displays)

### Software
- Raspberry Pi OS (64-bit with desktop)
- Python 3.9+
- ClickHouse cluster (we used Altinity Cloud Manager)

## Quick Start

1. **Clone this repository**
```bash
   git clone https://github.com/Altinity/bme680-clickhouse-demo.git
   cd bme680-clickhouse-demo
```

2. **Follow the setup guide**

   See [SETUP.md](SETUP.md) for detailed installation instructions.

3. **Configure your credentials**
```bash
   cp .env.example .env
   cp config.json.example config.json
   # Edit both files with your actual values
```

4. **Run the logger**
```bash
   source venv/bin/activate
   python sensor_to_clickhouse.py
```

## Project Structure
```
├── sensor_to_clickhouse.py  # Main data logger
├── test_bme680.py           # Test sensor readings
├── display_stats.py         # OLED stats display (optional)
├── requirements.txt         # Python dependencies
├── config.json.example      # Configuration template
├── .env.example             # Credentials template
├── .gitignore               # Don't commit .env and similar files to git
└── docs                     # Additional documentation
    ├── pinout.md            # Raspberry Pi pinout diagram
    └── troubleshooting.md   # Troubleshooting guide

```

## Features

### Temperature Calibration
The BME680 runs warm and picks up heat from the Raspberry Pi. We apply a configurable offset (default: -10°C) to compensate.

### Secure Authentication
Credentials are stored in environment variables and never committed to git. Basic authentication headers are automatically generated.

### Configurable Sampling
Adjust the sampling interval via `config.json` without touching code.

### OLED Integration
Optional system stats display showing IP address, CPU usage, memory, and disk space.

## ClickHouse Table Schema
```sql
CREATE TABLE demo.sensor_data
(
    time_stamp DateTime64(3),
    temp Float32,
    humidity Float32,
    pressure Float32,
    sensor String
)
ENGINE = MergeTree()
ORDER BY (sensor, time_stamp);
```

## Configuration

### config.json
- `clickhouse_url`: Your ClickHouse HTTP endpoint
- `sample_interval`: Seconds between readings (default: 60)
- `sensor_name`: Unique identifier for this sensor
- `log_to_console`: Enable/disable console output
- `temp_adjustment` : Adjust the temperature for heat generated by the Raspberry Pi

### .env
- `SENSOR_API_USERNAME`: ClickHouse username
- `SENSOR_API_PASSWORD`: ClickHouse password

### Python Script
- `TEMP_OFFSET_C`: Temperature calibration offset (line 23)

## Troubleshooting

See [docs/troubleshooting.md](docs/troubleshooting.md) for common issues and solutions.

## Blog Post

This demo accompanies our blog post: [Building IoT Analytics with ClickHouse and Raspberry Pi](#)

## Contributing

Found a bug? Have a suggestion? Open an issue or submit a pull request!

## License

MIT License - see LICENSE file for details

## Acknowledgments

- Built for [Altinity Cloud Manager](https://altinity.com)
- Uses the excellent [bme680 Python library](https://github.com/pimoroni/bme680-python)
- Inspired by the maker community's IoT projects