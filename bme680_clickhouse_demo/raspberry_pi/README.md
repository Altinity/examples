# Logging BME680 Sensor Data using a Raspberry Pi and ClickHouse Endpoints

This subproject is the Raspberry Pi version of the demo that shows you how to use a single-board computer (SBC) to log temperature, humidity, and pressure data from a BME680 sensor to a ClickHouse endpoint for real-time IoT analytics.

## Overview

This project demonstrates how to:
- Read environmental data from a BME680 sensor
- Apply temperature calibration for sensor self-heating
- Send data to ClickHouse via HTTP POST
- Display system stats on an OLED screen (optional)

Perfect for building IoT dashboards, environmental monitoring systems, or learning about sensor integration with analytical databases.

## What You'll Need

### Hardware
- Raspberry Pi (3 or newer recommended)
- BME680 breakout board (we used Pimoroni BME680 Breakout)
- MicroSD card (16GB+)
- Optional: OLED display (e.g., UCTronics Pi Rack Pro with SH1106 displays)

### Software
- Raspberry Pi OS (64-bit with desktop)
- Python 3.9+
- ClickHouse cluster (we used Altinity Cloud Manager)

## Quick Start

1. **Clone this repository**
```bash
   git clone https://github.com/Altinity/bme680-clickhouse-demo.git
   cd bme680-clickhouse-demo
```

2. **Follow the setup guide**

   See [SETUP.md](SETUP.md) for detailed installation instructions.

3. **Configure your credentials**
```bash
   cp .env.example .env
   cp config.json.example config.json
   # Edit both files with your actual values
```

4. **Run the logger**
```bash
   source venv/bin/activate
   python sensor_to_clickhouse.py
```

## Features

### Secure Authentication
Credentials are stored in environment variables and never committed to git. Basic authentication headers are automatically generated.

### Configurable Sampling
Adjust the sampling interval via `config.json` without touching code.

### Temperature Calibration
The BME680 runs warm and picks up heat from the Raspberry Pi. We apply a configurable offset (default: -10°C) to compensate.

## ClickHouse Table Schema
```sql
CREATE TABLE maddie.sensor_data ON CLUSTER '{cluster}'
(
   time_stamp DateTime64(3),
   temp Float32,
   humidity Float32,
   pressure Float32,
   sensor String
)
ENGINE = ReplicatedMergeTree('/clickhouse/{cluster}/tables/maddie/sensor_data', '{replica}')
ORDER BY tuple()
SETTINGS index_granularity = 8192;
```

## Configuration

### config.json
- `endpoint_url`: Your ClickHouse HTTP endpoint
- `sample_interval`: Seconds between readings (default: 60)
- `sensor_name`: Unique identifier for this sensor
- `log_to_console`: Enable/disable console output
- `temp_adjustment` : Adjust the temperature for heat generated by the Raspberry Pi (default: 0.0)

###  .env
- `CLICKHOUSE_USERNAME`: ClickHouse username
- `CLICKHOUSE_PASSWORD`: ClickHouse password

## Troubleshooting

See [the Troubleshooting section of SETUP.md](SETUP.md/#troubleshooting) for common issues and solutions.

## Blog Post

This demo accompanies our blog post: [Building IoT Analytics with ClickHouse and Raspberry Pi](#)

## Community

This project is a demo created by Altinity to accompany the blog post [Using Altinity.Cloud to Log Sensor Data with ClickHouse Endpoints](#). The best way to reach us or ask questions about the code is:

* Join [the Altinity Slack](https://altinity.com/slack) - Chat with the developers and other users
* Log [an issue on GitHub](https://github.com/Altinity/examples/issues) - Ask questions, log bugs and feature requests

## Contributing

We welcome contributions from the community! If you encounter issues or have improvements to suggest, please log an issue or submit a PR.

## Legal

All code, unless specified otherwise, is licensed under the Apache-2.0 license. Copyright ®2026 Altinity, Inc. Altinity.Cloud®, and Altinity Stable® are registered trademarks of Altinity, Inc. ClickHouse® is a registered trademark of ClickHouse, Inc.; Altinity is not affiliated with or associated with ClickHouse, Inc. Kubernetes, MySQL, and PostgreSQL are trademarks and property of their respective owners.
